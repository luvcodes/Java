DISK: 存放OS

BIOS: Basic IO system 基本I/O处理系统。一按电源就让计算机系统开始**检测各种外设**。把BIOS放到内存 (0x7C00) 中去。

Bootloader: 加载OS。让OS从硬盘放到内存中去，让CPU可以执行OS。

CS:IP = 0xf000:fff0 CS段寄存器，IP指令寄存器

  

POST 加电自检 寻找显卡和执行BIOS

  

  

![[%E6%88%AA%E5%B1%8F2024-01-15_%E4%B8%8A%E5%8D%8811.01.00.png]]

  

# 操作系统的interface (系统调用、异常和中断)

## 产生源头

![[%E6%88%AA%E5%B1%8F2024-01-15_%E4%B8%8A%E5%8D%8811.03.15.png]]

1. **中断（Interrupts）**：通常由硬件设备产生，用于通知处理器需要注意某些事件。例如，硬盘完成数据读取操作后会发出中断，通知处理器数据已准备好。
2. **异常（Exceptions）**：当程序执行出现错误时由处理器产生。例如，除零错误或访问非法内存地址时，处理器会产生异常。
3. **系统调用（System Calls）**：这是程序与操作系统之间的接口。当程序需要操作系统服务，如文件操作、进程控制等时，会通过系统调用请求操作系统提供服务。

## 处理时间

![[%E6%88%AA%E5%B1%8F2024-01-15_%E4%B8%8A%E5%8D%8811.11.08.png]]

- **中断**：是异步的，因为它们是由外部事件触发的，与当前处理器执行的程序无关。
- **异常**：可以认为是同步的，因为它们是由当前执行的指令产生的，如除零错误。
- **系统调用**：通常是同步的，因为程序执行系统调用时会等待操作系统完成这个调用。例如，一个读文件的系统调用会使程序等待直到文件读取完成。

### 同步与异步

理解异步（Asynchronous）和同步（Synchronous）的概念，通常涉及到任务执行的时序和协调方式。

在**同步**操作中，任务按照顺序执行，每个任务必须在下一个任务开始之前完成。这意味着在当前任务完成之前，程序的执行将被阻塞。在同步操作中，执行的顺序和时间是可预测的。

- **举例**：考虑一个简单的程序，它首先从磁盘读取文件，然后处理这个文件。在同步模式下，程序将首先等待文件完全读取完毕，然后才开始处理文件。在文件读取过程中，程序不会进行任何其他操作。

**异步**操作允许任务在等待期间继续执行其他任务。这意味着程序可以启动一个操作（如数据读取、网络请求等），然后在该操作完成之前继续执行，而不是等待它完成。当异步操作完成时，程序将以某种方式（通常是回调函数、事件、信号等）得到通知。

- **举例**：在异步模式下，程序可能会发起一个文件读取操作，然后立即执行其他任务。文件读取在后台进行，当读取操作完成时，程序会收到通知，并可以处理这个文件。在此期间，程序不会被阻塞，可以继续执行其他任务。

## 响应状态

![[%E6%88%AA%E5%B1%8F2024-01-15_%E4%B8%8A%E5%8D%8811.18.38.png]]

  

# 中断 处理过程

![[%E6%88%AA%E5%B1%8F2024-01-15_%E4%B8%8A%E5%8D%8811.28.03.png]]

  

![[%E6%88%AA%E5%B1%8F2024-01-15_%E4%B8%8A%E5%8D%8811.30.57.png]]

  

# 异常 处理过程

  

![[%E6%88%AA%E5%B1%8F2024-01-15_%E4%B8%8A%E5%8D%8811.33.07.png]]

  

  

  

![[%E6%88%AA%E5%B1%8F2024-01-15_%E4%B8%8A%E5%8D%8811.46.01.png]]

  

# 用户态与内核态

用户态（User Mode）和内核态（Kernel Mode）是操作系统中两种不同的执行模式，它们**定义了代码执行时可访问资源的权限级别**。这两种模式是现代操作系统中保护和隔离不同操作及其影响的关键机制。

## 用户态（User Mode）

1. **权限限制**：在用户态下，程序的运行受到较多限制。它们不能直接访问硬件资源，也不能执行某些可能影响系统整体稳定性的操作。
2. **运行应用程序**：用户态主要用于运行应用程序。这些应用程序不能直接执行内核功能，而是通过系统调用（System Calls）与内核交互。
3. **安全性**：用户态提供了一种安全层，防止应用程序直接访问关键的系统资源，从而减少了程序错误对整个系统的影响。

## 内核态（Kernel Mode）

1. **完全访问权限**：在内核态下，操作系统拥有对硬件的完全访问权限。它可以执行包括访问所有硬件、执行CPU指令等所有操作。
2. **系统级操作**：内核态用于执行操作系统的核心功能，如管理内存、进程调度、文件系统操作、网络通信等。
3. **效率和风险**：虽然内核态允许高效率地执行操作，但也增加了风险。内核级的错误可能导致整个系统崩溃或安全问题。

## 切换

- **系统调用**：当用户态下的程序需要执行不能在用户态下进行的操作时（如文件访问、网络通信），它会通过系统调用请求内核代为执行。这时，操作系统会从用户态切换到内核态。
- **中断和异常**：当发生硬件中断或异常时，处理器也会从用户态切换到内核态，以便操作系统能够响应这些事件。

这种区分确保了操作系统的稳定性和安全性，同时允许用户程序在受限的环境中运行，防止它们干扰系统操作或访问敏感资源。

### 从内核态切换到用户态

1. **系统调用完成**：当系统调用（例如文件读写、网络请求等）在内核态中被处理完成后，操作系统会将控制权返回给用户态的程序，继续执行用户级别的操作。
2. **中断处理完成**：当操作系统在内核态下响应完硬件中断（如键盘输入、网络数据包接收等）之后，会返回到之前的用户态程序。
3. **异常处理**：如果内核成功处理了一个异常（如程序错误或非法操作），它可能会返回控制权到用户态的应用程序，或者决定终止或重新启动有问题的程序。

## 用户态、内核态与操作系统的三大接口

操作系统的三大接口——中断、异常和系统调用，与用户态和内核态之间的切换紧密相关：

1. **系统调用**：这是用户态程序与内核态之间交互的主要方式。当用户态程序需要执行无法直接进行的操作时（如文件系统访问、网络通信等），它会发起系统调用。这个调用导致处理器从用户态切换到内核态，执行所需的操作，然后再切换回用户态。
2. **中断**：中断主要由硬件设备产生，用于告知CPU有重要事件需要立即处理。当中断发生时，CPU从当前执行的用户态程序（如果正在执行）切换到内核态，处理中断，然后再返回到用户态。
3. **异常**：异常是程序执行中的错误或特殊情况（如除零错误、无效的内存访问等）。当异常发生时，CPU从引起异常的程序（用户态）切换到内核态以处理异常，处理完成后可能返回用户态，或者采取其他措施（如程序终止）。

### 关系和重要性

- 这两种状态以及状态间的切换对操作系统的稳定性和安全性至关重要。通过将操作系统核心和用户程序分离，可以防止用户程序直接访问硬件或执行高权限操作，从而避免潜在的系统崩溃或安全风险。
- 用户态和内核态的切换也是操作系统设计中的一个关键考虑因素，影响着系统的性能和响应能力。频繁的状态切换会带来性能开销，因此需要精心设计以保持高效运行。

# 跨越操作系统边界的开销

![[%E6%88%AA%E5%B1%8F2024-01-15_%E4%B8%8A%E5%8D%8811.52.18.png]]