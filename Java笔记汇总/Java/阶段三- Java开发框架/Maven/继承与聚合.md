# 聚合

Maven中的聚合指的是多个模块（项目）被一起构建的过程。这通常是通过在一个父POM文件中定义一个特殊类型的项目实现的，该项目包含一个`<modules>`元素，它列出了所有应该作为构建一部分的子模块（子项目）的名称。

聚合是通过在父POM中添加一个模块列表来完成的，例如：

```XML
<project>
    ...
    <packaging>pom</packaging>
    ...
    <modules>
        <module>module1</module>
        <module>module2</module>
        ...
    </modules>
    ...
</project>
```

在这个例子中，父项目本身不包含任何源代码，其`<packaging>`类型通常是`pom`。该父项目的目的主要是聚合子模块，当你在父项目目录下运行Maven构建命令时（比如`mvn clean install`），它会自动遍历所有定义的模块，并依次构建它们。

聚合确保了所有子模块按照正确的顺序构建，特别是当子模块之间存在依赖关系时。这使得开发者可以轻松地一次构建整个项目，而不必逐个构建每一个子模块。

# 聚合工程

在Maven中，聚合工程（Aggregation）是指一个工程通过在它的POM文件中列出多个模块，来同时构建这些模块的设定。这样的一个父工程通常用来组织多模块项目，每个模块都是一个独立的Maven工程，有自己的POM文件和构建生命周期。聚合工程的一个主要特征是它的pom.xml文件中的<packaging>元素被设置为pom，而不是其他的值（如jar或war）。这表明这个POM是用来聚合多个模块的。

# 如何实现？

要实现Maven中的聚合，你需要创建一个父POM文件，并在其中列出所有要聚合的子模块。下面是实现Maven聚合的基本步骤：

1. **创建父POM：** 在你的多模块项目的根目录下创建一个Maven项目，并将其`<packaging>`类型设置为`pom`。
2. **定义模块：** 在父POM中使用`<modules>`标签来定义所有子模块。
3. **创建子模块：** 在与父POM同一目录层级的子目录中创建子模块。每个子模块都是一个独立的Maven项目，具有自己的`pom.xml`文件。
4. **子模块的POM：** 在每个子模块的`pom.xml`文件中，你可以定义模块特有的依赖、插件和其他构建配置。确保在每个子模块的POM中指定父POM。

这里是详细的步骤：

**步骤 1：创建父POM**

```XML
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <groupId>com.example</groupId>
    <artifactId>parent-project</artifactId>
    <version>1.0</version>
    <packaging>pom</packaging>

    <modules>
        <module>child-module1</module>
        <module>child-module2</module>
        <!-- 更多模块 -->
    </modules>

    <!-- 公共依赖或插件管理 -->
</project>
```

**步骤 2：创建子模块目录和POM**

在项目根目录下创建子模块目录（例如`child-module1`和`child-module2`），然后在每个子目录中创建一个`pom.xml`文件。

子模块的`pom.xml`可能看起来像这样：

```XML
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>com.example</groupId>
        <artifactId>parent-project</artifactId>
        <version>1.0</version>
    </parent>

    <artifactId>child-module1</artifactId>

    <!-- 模块特定依赖或插件 -->
</project>
```

请注意，子模块中的`<parent>`元素指向父POM。

**步骤 3：构建聚合项目**

要构建聚合项目，你只需在父POM所在的目录运行Maven命令，例如：

```Shell
mvn clean install
```

这个命令将依次构建所有在父POM中列出的模块。这样做的好处是，当多个模块是项目的一部分时，它们可以共享相同的依赖版本和插件配置，同时还可以单独构建每个模块。聚合也能够保证构建顺序，特别是当模块之间有依赖关系时。

# 继承

在Maven中，继承是指子项目（子模块）可以从父项目（通常被称为父POM）继承配置。父项目的`pom.xml`文件定义了通用的配置，这些配置可以被一个或多个子项目共享。通过继承，可以减少配置的冗余，保持项目结构的一致性，以及方便管理多个模块的项目。

继承的关键特性包括：

- **共享配置：** 父POM可以定义通用的依赖、插件、属性和其他管理信息，子POM可以继承并使用这些配置。
- **重写配置：** 子POM可以重写继承自父POM的配置，这提供了灵活性，允许子模块根据需要调整其配置。
- **传递性：** 父POM本身也可以有父POM，形成一个继承层次结构。

实现继承的基本步骤：

1. **定义父POM：** 创建一个包含通用配置的父POM。通常，**它的**`**<packaging>**`**设置为**`**pom**`。
2. **在子POM中指定父POM：** 子模块的`pom.xml`中使用`<parent>`元素指定父POM的坐标（`groupId`，`artifactId`和`version`）。
3. **运用继承特性：** 子POM将自动继承父POM中定义的所有配置，除非在子POM中明确地重写了它们。

**父POM (**`**parent-pom.xml**`**):**

```XML
<project>
    <modelVersion>4.0.0</modelVersion>
    <groupId>com.example</groupId>
    <artifactId>parent</artifactId>
    <version>1.0</version>
    <packaging>pom</packaging>

    <properties>
        <!-- 定义一些通用的属性 -->
    </properties>

    <dependencyManagement>
        <!-- 在这里管理依赖的版本 -->
        <dependencies>
            <!-- 定义的共享依赖 -->
        </dependencies>
    </dependencyManagement>

    <build>
        <plugins>
            <!-- 定义通用的插件配置 -->
        </plugins>
    </build>
    ...
</project>
```

**子POM (**`**child-pom.xml**`**):**

```XML
<project>
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>com.example</groupId>
        <artifactId>parent</artifactId>
        <version>1.0</version>
    </parent>

    <artifactId>child</artifactId>

    <!-- 子模块特有的配置，如依赖、属性等 -->
    ...
</project>
```

在这个例子中，子POM定义了它的父POM。当Maven处理子POM时，它会合并来自父POM的配置以及子POM中定义的任何特定配置。

请记住，**继承不同于依赖。继承用于项目构建的配置，而依赖用于项目运行时所需的库**。

# 如何实现？

[![](https://cdn.nlark.com/yuque/0/2023/png/38953059/1699239188874-3c56e36c-ec12-43cd-88ca-250336cc4f29.png)](https://cdn.nlark.com/yuque/0/2023/png/38953059/1699239188874-3c56e36c-ec12-43cd-88ca-250336cc4f29.png)

[![](https://cdn.nlark.com/yuque/0/2023/png/38953059/1699239207024-b6f9428d-8fbc-40cc-947b-eeeff3cb2cb9.png)](https://cdn.nlark.com/yuque/0/2023/png/38953059/1699239207024-b6f9428d-8fbc-40cc-947b-eeeff3cb2cb9.png)

这里第三步重点就是“可选”。是在父工程中定义下面的依赖关系，这些依赖关系是在子工程中可选的。

[![](https://cdn.nlark.com/yuque/0/2023/png/38953059/1699239259323-d18f2f33-09f5-4409-9bb1-dedbdd530d7c.png)](https://cdn.nlark.com/yuque/0/2023/png/38953059/1699239259323-d18f2f33-09f5-4409-9bb1-dedbdd530d7c.png)

[![](https://cdn.nlark.com/yuque/0/2023/png/38953059/1699239266723-d5dd722b-63e6-4808-89c7-fa3429798ed5.png)](https://cdn.nlark.com/yuque/0/2023/png/38953059/1699239266723-d5dd722b-63e6-4808-89c7-fa3429798ed5.png)

[![](https://cdn.nlark.com/yuque/0/2023/png/38953059/1699239279488-22e4c071-948f-4599-b159-1ab6fc4063f2.png)](https://cdn.nlark.com/yuque/0/2023/png/38953059/1699239279488-22e4c071-948f-4599-b159-1ab6fc4063f2.png)

# 聚合和继承的区别

[![](https://cdn.nlark.com/yuque/0/2023/png/38953059/1699239432389-66fc4e7d-9d74-4f87-a496-9da3ddcc2bbd.png)](https://cdn.nlark.com/yuque/0/2023/png/38953059/1699239432389-66fc4e7d-9d74-4f87-a496-9da3ddcc2bbd.png)

在Maven中，继承（Inheritance）和聚合（Aggregation）是两种不同的项目关系，它们在多模块项目构建中扮演不同的角色。

# 继承（Inheritance）

继承用于共享配置，允许一个Maven项目继承另一个项目的配置。通过继承，子项目可以复用父项目的配置，如插件配置、属性、依赖管理等。在父项目的`pom.xml`文件中定义的任何配置（除了`groupId`、`version`和`dependencies`之外的部分）都可以被子项目继承。

一个Maven项目可以声明一个父项目，这通过在子项目的`pom.xml`文件中包含一个`<parent>`元素来实现，指向父项目的坐标（`groupId`、`artifactId`和`version`）。

# 聚合（Aggregation）

聚合涉及到将多个模块组合在一起构建。聚合是在一个父项目中定义，通常用来同时构建多个相关的模块。聚合通过在父项目的`pom.xml`中的`<modules>`元素中定义，列出所有子模块的目录名称。

当运行Maven构建时，如果一个项目是一个聚合项目，Maven将递归地构建每一个列在`<modules>`列表中的子模块。这样可以很容易地构建整个项目及其所有模块，只需在顶层父项目上执行Maven命令即可。

# 继承 vs 聚合

- **目的不同：**
- 继承是为了复用配置，减少重复和维护工作量。
- 聚合是为了便于一次性构建多个模块。
- **配置方式不同：**
- 继承通过`<parent>`标签在子项目中指定父项目。
- 聚合通过`<modules>`标签在父项目中列出所有子模块。
- **使用场景不同：**
- 继承通常用于需要应用共通配置（比如依赖版本管理）到多个相关模块中的场景。
- 聚合通常用于当你想要通过单一的入口构建多个模块的项目。

在实际应用中，继承和聚合常常一起使用。一个多模块的Maven项目可以通过一个父POM来聚合所有模块，同时这个父POM也是子模块继承配置的来源。这样做可以让你的项目既具有统一的配置，又可以简单地一键构建全部模块。

# 具体例子

### 继承（Inheritance）示例

假设你有一个父项目（通常被称为父POM），它的`pom.xml`可能看起来像这样：

```XML
<!-- 父项目的pom.xml -->
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

    <modelVersion>4.0.0</modelVersion>
    <groupId>com.example</groupId>
    <artifactId>parent-project</artifactId>
    <version>1.0</version>
    <packaging>pom</packaging>

    <dependencyManagement>
        <dependencies>
            <dependency>
                <groupId>org.springframework</groupId>
                <artifactId>spring-core</artifactId>
                <version>5.3.10</version>
            </dependency>
            <!-- 更多的依赖管理项 -->
        </dependencies>
    </dependencyManagement>

    <!-- 其他通用配置如插件管理等 -->
    ...
</project>
```

然后你有一个子项目，它通过`<parent>`元素继承了父项目的配置：

```XML
<!-- 子项目的pom.xml -->
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>com.example</groupId>
        <artifactId>parent-project</artifactId>
        <version>1.0</version>
    </parent>

    <artifactId>child-project</artifactId>

    <dependencies>
        <dependency>
            <groupId>org.springframework</groupId>
            <artifactId>spring-core</artifactId>
            <!-- 版本号从父POM继承 -->
        </dependency>
        <!-- 其他依赖 -->
    </dependencies>

    ...
</project>
```

### 聚合（Aggregation）示例

对于聚合，你的父POM会列出所有的子模块，让Maven知道它需要构建哪些模块：

```XML
<!-- 父项目的pom.xml -->
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">

    <modelVersion>4.0.0</modelVersion>
    <groupId>com.example</groupId>
    <artifactId>parent-aggregator</artifactId>
    <version>1.0</version>
    <packaging>pom</packaging>

    <modules>
        <module>child-project1</module>
        <module>child-project2</module>
        <!-- 更多模块 -->
    </modules>

    ...
</project>
```

每个子模块的`pom.xml`文件则不需要包含特别的聚合配置，它们只是普通的Maven项目，可以选择性地继承父POM。当在父POM所在的目录执行Maven构建命令时（例如`mvn clean install`），Maven会自动构建所有列在`<modules>`元素中的模块。

综上，这些示例显示了如何在Maven中使用继承来共享依赖管理和其他配置，以及如何使用聚合来构建多个相关模块。