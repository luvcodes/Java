# 全局UUID (全局唯一ID)

用户抢购业务，订单表如果使用数据库自增ID就存在一些问题:

- id规律性太明显，容易被用户找到规律
- 受表单数据量的限制。数据量太大之后，单表很难存储了。在mysql中每张表的id又都是独立控制的，所以就有可能出现多表的不同数据，id字段值相同，损失了唯一性。

  

全局ID生成器，是一种在分布式系统下用来生成全局唯一ID的工具，有下列特性:

![[%E6%88%AA%E5%B1%8F2024-01-11_%E4%B8%8A%E5%8D%889.18.16.png]]

为了增加ID的安全性，我们可以不直接使用Redis自增的数值，而是拼接一些其他信息。

![[%E6%88%AA%E5%B1%8F2024-01-11_%E4%B8%8A%E5%8D%889.22.36.png]]

  

# 实现优惠券秒杀下单

  

# 超卖问题

## 解决方法

![[%E6%88%AA%E5%B1%8F2024-01-11_%E4%B8%8A%E5%8D%8810.52.58.png]]

## 悲观锁

添加同步锁，让线程串行执行

优点: 简单粗暴

缺点: 性能一般

## 乐观锁

关键是判断之前查询得到的数据是否有被修改过

不加锁，在更新时判断是否有其他线程做了修改

优点: 性能好

缺点: 存在成功率低的问题

### 版本号法

用版本标识数据有没有变化

![[%E6%88%AA%E5%B1%8F2024-01-11_%E4%B8%8A%E5%8D%8810.58.05.png]]

### CAS法

  

![[%E6%88%AA%E5%B1%8F2024-01-11_%E4%B8%8A%E5%8D%8811.01.38.png]]