Spring Cloud Gateway 是 Spring Cloud 的一个全新项目，该项目是基于 Spring 5.0，Spring Boot 2.0 和 Project Reactor 等响应式编程和事件流技术开发的网关，它**旨在为微服务架构提供一种简单有效的统一的 API 路由管理方式**。

![[Untitled 31.png]]

**权限控制**：网关作为微服务入口，需要校验用户是是否有请求资格，如果没有则进行拦截。

**路由和负载均衡**：一切请求都必须先经过gateway，但网关不处理业务，而是根据某种规则，把请求转发到某个微服务，这个过程叫做路由。当然路由的目标服务有多个时，还需要做负载均衡。

**限流**：当请求流量过高时，在网关中按照下流的微服务能够接受的速度来放行请求，避免服务压力过大。

在SpringCloud中网关的实现包括两种：
- gateway
- zuul
Zuul是基于Servlet的实现，属于阻塞式编程。而SpringCloudGateway则是基于Spring5中提供的WebFlux，属于**响应式编程**的实现，具备更好的性能。

# 为什么需要网关 Gateway？

想象一下，你有一个大型购物中心，里面有很多不同的商店，每个商店都是一个微服务。现在，如果没有中心信息台（即网关），顾客（即客户端请求）每次来到购物中心时，都需要自己找到他们想去的具体店铺，这样会非常麻烦和低效。

**网关的作用类似于这个购物中心的中心信息台**：

1. **请求路由**：就像信息台会告诉你哪里有服装店，哪里有电子产品店一样，网关知道如何将请求送到正确的服务。网关作为微服务架构中的前端分发层，负责将外部请求按照预定规则分发到对应的服务。这一机制简化了服务发现的过程，使得客户端无需知晓后端服务的具体位置。

2. **负载均衡**：信息台看到某个店铺太忙，可能会建议你去另一个同样的店铺，这样可以防止某一个店铺过于拥挤。网关能够根据服务的当前负载情况，动态地将请求分配到不同的实例。这不仅优化了资源的使用，还提高了服务的可用性和响应速度。

3. **安全控制**：信息台在你进入之前检查你的包和票，确保你有权进入某个店铺。网关提供了一个集中的点来执行认证和授权操作，确保只有验证过的用户才能访问敏感数据和操作。此外，网关也可以进行 SSL 终端，提供加密的数据传输。

4. **API 聚合**：如果你需要在多个店铺购物，信息台帮助你规划路线，让你一次过可以完成所有购物，而不是来回跑多次。网关可以将来自多个微服务的数据聚合成单一响应，减少了客户端需要进行的网络调用数量，从而降低了延迟和提高了用户体验。

5. **限流和熔断**：如果信息台发现某个店铺现在太忙，可能暂时不让顾客进去，防止店铺服务质量因为过载而下降。网关可以实施流量控制策略，如请求限流和熔断机制，以防止服务因过载而崩溃，保证系统的稳定性。

6. **监控和日志**：信息台还会记录所有顾客的进出信息，帮助购物中心管理和优化顾客体验。网关可以记录进出所有微服务的请求日志，为系统提供了丰富的数据源以监控性能指标和可能的异常，方便进行故障排查和性能优化。

所以，网关在微服务架构中，就是一个能够有效管理、优化和保护系统的“信息台”，使得整个系统运作更加高效和安全。希望这个比喻能帮助你更好地理解网关的作用！网关在微服务架构中，不仅是流量的入口，也是实现多种跨服务功能（如安全、监控、稳定性保障）的关键组件。通过这样的集中式设计，微服务架构的管理变得更为高效和有序。
# 跨域问题

在Web开发中，"跨域"是指由于浏览器的同源策略限制，不同域之间的资源请求被限制的情况。同源策略要求执行脚本的网页与它所请求的资源具有相同的**协议**（如http）、**域名**（如localhost）和**端口号**（如8090）。如果其中之一有不匹配，就会被视为跨域。

例如，当你试图从运行在端口8090的服务器（例如，[http://localhost:8090](http://localhost:8090/)）发送请求到运行在端口10010的服务器（例如，[http://localhost:10010](http://localhost:10010/)）时，由于端口号不同，请求就会被视为跨域。

解决这种问题通常需要在服务器端设置适当的CORS策略。

