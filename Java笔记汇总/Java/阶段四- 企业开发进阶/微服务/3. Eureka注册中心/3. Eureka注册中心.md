假如我们的服务提供者user-service部署了多个实例，如图：

![[Untitled 30.png]]

大家思考几个问题：

- order-service在发起远程调用的时候，该如何得知user-service实例的ip地址和端口？
- 有多个user-service实例地址，order-service调用时该如何选择？
- order-service如何得知某个user-service实例是否依然健康，是不是已经宕机？

# Eureka工作原理

![[%E6%88%AA%E5%B1%8F2024-01-17_%E4%B8%8B%E5%8D%884.59.20.png]]

  

这些问题都需要利用SpringCloud中的注册中心来解决，其中最广为人知的注册中心就是Eureka，其结构如下：

回答之前的各个问题。

问题1：order-service如何得知user-service实例地址？

获取地址信息的流程如下：

- user-service服务实例启动后，将自己的信息注册到eureka-server（Eureka服务端）。这个叫服务注册
- eureka-server保存服务名称到服务实例地址列表的映射关系
- order-service根据服务名称，拉取实例地址列表。这个叫服务发现或服务拉取

问题2：order-service如何从多个user-service实例中选择具体的实例？

- order-service从实例列表中利用负载均衡算法选中一个实例地址
- 向该实例地址发起远程调用

问题3：order-service如何得知某个user-service实例是否依然健康，是不是已经宕机？

- user-service会每隔一段时间（默认30秒）向eureka-server发起请求，报告自己状态，称为心跳
- 当超过一定时间没有发送心跳时，eureka-server会认为微服务实例故障，将该实例从服务列表中剔除
- order-service拉取服务时，就能将故障实例排除了

> 注意：一个微服务，既可以是服务提供者，又可以是服务消费者，因此eureka将服务注册、服务发现等功能统一封装到了eureka-client端

## **3.1.Eureka的结构和作用**

# 补充知识

Eureka的工作原理可以从两个主要部分来理解：服务注册和服务发现。

## 服务注册

1. **Eureka Server**：Eureka的服务端称为Eureka Server，它提供一个服务注册表，用于存储各个服务的信息。服务实例在启动时会将自己的信息（如服务名、IP地址、端口等）注册到Eureka Server上。
2. **服务实例的注册**：当一个服务实例启动时，它会向Eureka Server发送一个注册请求。Eureka Server接收到请求后，会将该服务实例的信息存储在内部的注册表中。这样，Eureka Server就知道了哪些服务实例是可用的。
3. **心跳检测**：为了维持服务实例的活性，每个服务实例需要定期（默认每30秒）向Eureka Server发送心跳信号。如果Eureka Server在一定时间内（默认90秒）没有收到某个服务实例的心跳，它会认为该实例不可用，并从注册表中移除该实例。

**只要是在引入eureka依赖 + 配置文件注册 就是在做服务注册**

## 服务发现

1. **服务消费者**：服务消费者是指需要调用其他服务的应用。**服务消费者会向Eureka Server查询注册表，以获取所需服务实例的信息**。
2. **获取服务实例信息**：当服务消费者要进行远程调用时，它会向Eureka Server请求所需服务的实例信息。Eureka Server返回可用的服务实例列表，服务消费者根据这个列表，通过负载均衡算法选择一个实例进行调用。

### 总结

Eureka的工作原理基于客户端-服务端架构。服务端（Eureka Server）维护一个服务注册表，而客户端（服务实例）负责向服务端注册自己的信息并定期发送心跳。服务消费者通过查询Eureka Server获取需要的服务实例信息，并进行远程调用。这种机制支持动态的服务注册和发现，是微服务架构中实现服务间通信的关键组成部分。

# Eureka的作用

![[%E6%88%AA%E5%B1%8F2024-01-17_%E4%B8%8B%E5%8D%884.53.24.png]]

# Eureka中的角色

![[%E6%88%AA%E5%B1%8F2024-01-17_%E4%B8%8B%E5%8D%884.54.32.png]]