[一篇文章搞定 Nginx 反向代理与负载均衡 - 哈喽沃德先生 - 博客园 (cnblogs.com)](https://www.cnblogs.com/mrhelloworld/p/nginx.html)

# 负载均衡

负载均衡（Load Balance）是由多台服务器以对称的方式组成一个服务器集群，每台服务器都具有等价的地位，都可以单独对外提供服务而无须其他服务器的辅助。经过某种负载分管技术，将外部发送来的中央请求均匀分配到对称结构中的某一台服务器上。

![[/Untitled 10.png|Untitled 10.png]]

  

# 反向代理

反向代理中的代理服务器，代理的是服务器那端。

代理服务器接收客户端请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给客户端，此时代理服务器对外表现为一个反向代理服务器的角色。

反向代理服务器位于用户与目标服务器之间，但是对于用户而言，反向代理服务器就相当于目标服务器，即用户直接访问反向代理服务器就可以获得目标服务器的资源。同时，用户不需要知道目标服务器的地址，也无须在用户端作任何设定。

一句话总结：反向代理，就是代理服务器代理了目标服务器，去和客户端进行交互。

# Nginx实现反向代理和负载均衡

Nginx可以同时充当反向代理服务器和负载均衡器。

它的特点在于不仅可以作为反向代理，还可以实现负载均衡，也就是说它结合了反向代理和负载均衡的功能，从而能够更好地处理高并发和大流量的情况。因此，Nginx在实际应用中经常被用来解决负载均衡和反向代理的问题。

当如果服务以集群的方式进行部署时，那nginx在转发请求到服务器时就需要做相应的负载均衡。其实，负载均衡从本质上来说也是基于反向代理来实现的，最终都是转发请求。

# Nginx如何实现反向代理和负载均衡？

1. 反向代理的实现方式：
    - 配置proxy_pass指令：在Nginx的配置文件中，通过设置proxy_pass指令来指定反向代理的目标服务器地址，实现请求转发。
    - 配置upstream模块：使用upstream模块定义后端服务器组，然后在location中使用proxy_pass指向定义的后端服务器组，实现反向代理和负载均衡。
2. 负载均衡的实现方式：
    - 轮询（Round Robin）：默认的负载均衡方式，将请求依次分配到各个后台服务器中，适用于后台机器性能一致的情况。
    - 加权轮询（Weighted Round Robin）：根据后端服务器的配置权重来分配请求，适用于后台机器性能不一致的情况。
    - IP哈希（IP Hash）：根据客户端IP的哈希结果来决定将请求分发到哪一台后端服务器上，可以实现会话粘滞。
    - 最小连接数（Least Connections）：将请求分配到当前连接数最少的后端服务器上，适用于后台机器性能不一致的情况。

## Nginx实现负载均衡

|   |   |
|---|---|
|名称|说明|
|轮询|默认方式|
|weight|权重方式，默认为1，权重越高，被分配的客户端请求就越多|
|ip_has​​h|依据ip分配方式，这样每个访客​可以固定访问一个后端服务|
|least_conn|依据最少连接方式，把请求优先分配给连接数少的后端服务|
|url_hash|依据url分配方式，这样相同的url会被分配到同一个后端服务|
|fair|依据响应时间方式，响应时间短的服务将会被优先分配|