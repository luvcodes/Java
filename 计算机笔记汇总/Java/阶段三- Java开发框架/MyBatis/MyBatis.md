# MyBatis简介

MyBatis的出现是为了取代JDBC技术，因为JDBC需要编写大量的重复代码，而MyBatis可以通过XML或注解的方式，将SQL语句和Java代码分离，从而使得代码更加简洁易懂。Mybatis框架，就是对原始的JDBC程序的封装。

# 数据库连接池

在前面我们所讲解的mybatis中，使用了数据库连接池技术，避免频繁的创建连接、销毁连接而带来的资源浪费。

没有使用数据库连接池的时候，客户端执行SQL语句：要先创建一个新的连接对象，然后执行SQL语句，SQL语句执行后又需要关闭连接对象从而释放资源，每次执行SQL时都需要创建连接、销毁链接，这种频繁的重复创建销毁的过程是比较耗费计算机的性能。

数据库连接池是个容器，负责分配、管理数据库连接(Connection)

- 程序在启动时，会在数据库连接池(容器)中，创建一定数量的Connection对象

允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个

- 客户端在执行SQL时，先从连接池中获取一个Connection对象，然后在执行SQL语句，SQL语句执行完之后，释放Connection时就会把Connection对象归还给连接池（Connection对象可以复用）

释放空闲时间超过最大空闲时间的连接，来避免因为没有释放连接而引起的数据库连接遗漏

- 客户端获取到Connection对象了，但是Connection对象并没有去访问数据库(处于空闲)，数据库连接池发现Connection对象的空闲时间 > 连接池中预设的最大空闲时间，此时数据库连接池就会自动释放掉这个连接对象

数据库连接池的好处：

1. 资源重用
2. 提升系统响应速度
3. 避免数据库连接遗漏

## 实现数据库连接池

- 官方(sun)提供了数据库连接池标准（javax.sql.DataSource接口）
- 功能：获取连接

```Java
public Connection getConnection() throws SQLException;
```

- 第三方组织必须按照DataSource接口实现

常见的数据库连接池：

- C3P0
- DBCP
- Druid
- Hikari (springboot默认)

现在使用更多的是：Hikari、Druid  （性能更优越）

# 预编译SQL

预编译SQL有两个优势：

1. 性能更高
2. 更安全(防止SQL注入)

性能更高：预编译SQL，编译一次之后会将编译后的SQL语句缓存起来，后面再次执行这条语句时，不会再次编译。（只是输入的参数不同）

更安全(防止SQL注入)：将敏感字进行转义，保障SQL的安全性。

# 参数占位符

在Mybatis中提供的参数占位符有两种：${..} 、#{..}

- #{..}
- 执行SQL时，会将#{…}替换为?，生成预编译SQL，会自动设置参数值
- 使用时机：参数传递，都使用#{..}
- ${..}
- 拼接SQL。直接将参数拼接在SQL语句中，存在SQL注入问题
- 使用时机：如果对表名、列表进行动态设置时使用

注意事项：在项目开发中，建议使用#{..}，生成预编译SQL，防止SQL注入安全。

  

[[MyBatis基础操作]]

[[Mybatis的XML配置文件]]

[[Mybatis的XML配置文件]]

[[动态SQL]]